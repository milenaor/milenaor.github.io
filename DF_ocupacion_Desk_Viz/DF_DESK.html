<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Load font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fauna+One&display=swap" rel="stylesheet">

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>

// set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 40, left: 130},
    width = 1200 - margin.left - margin.right,
    height = 750 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g") //¿g?//
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

// Parse the Data
d3.csv("https://raw.githubusercontent.com/milenaor/milenaor.github.io/master/4DF_Viz.csv", function(data) {

// sort data
data.sort(function(b, a) {
  return a.Value - b.Value;
});
    
// Y axis text number 
var y = d3.scaleBand()
  .range([ 0, height ])
  .domain(data.map(function(d) { return d.Value; }))
  .padding(1);
svg.append("g")
    .attr("transform", "translate(0," + -6 + ")")
    .call(d3.axisRight(y))
    .selectAll("text")
    .attr ("font-family", function (d, i) {return i <5? "Fauna One": "Fauna One";})
    .attr("text-anchor", "right")
    .style("font-size", 12)
    .attr("fill", "#06303D")
    
// Add X axis
var x = d3.scaleLinear()
  .domain([0, 5000])
  .range([ 0, width]);
svg.append("g")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.axisBottom(x))
  .selectAll("text")
    .attr ("font-family", function (d, i) {return i <5? "Fauna One": "Fauna One";})
    .attr("transform", "translate(-13,0)rotate(-90)")
    //.attr("dominant-baseline", "text-before-edge")
    .attr("fill", "#06303D")
    .style("text-anchor", "end");
          

// Y axis
var y = d3.scaleBand()
  .range([ 0, height ])
  .domain(data.map(function(d) { return d.Occupation; }))
  .padding(1);
svg.append("g")
  .call(d3.axisLeft(y))
    .selectAll("text")
    .attr ("font-family", function (d, i) {return i <5? "Fauna One": "Fauna One";})
    .attr("fill", "#06303D")
    
    
//<!-- Load image montaña -->//
var img = svg.append('svg:image')
  img
 .attr("xlink:href","https://raw.githubusercontent.com/milenaor/milenaor.github.io/master/DF_ocupacion_Desk_Viz/img/motaña.svg")
 .attr("x", "-80")
 .attr("y", "-48")
 .attr("width", `${width + margin.left + margin.right}`)
 .attr("height", `${height + margin.top + margin.bottom}`);
    
    
//<!-- Load image mapa -->//
var img = svg.append('svg:image')
 img
 .attr("xlink:href","https://raw.githubusercontent.com/milenaor/milenaor.github.io/master/DF_ocupacion_Desk_Viz/img/mapa.svg")
 
 .transition()
 .duration(3000)
 .style("fill", "https://raw.githubusercontent.com/milenaor/milenaor.github.io/master/DF_ocupacion_Desk_Viz/img/mapa_color.svg")

 .attr("x", "-80")
 .attr("y", "-48")
 
 .attr("width", `${width + margin.left + margin.right}`)
 .attr("height", `${height + margin.top + margin.bottom}`);
    
    
 
    
   


// Lines
svg.selectAll("myline")
  .data(data)
  .enter()
  .append("line")
    .attr("x1", x(0))
    .attr("x2", x(0))
    .attr("y1", function(d) { return y(d.Occupation); })
    .attr("y2", function(d) { return y(d.Occupation); })
    .attr("stroke", "#06303D")

// Circles -> start at X=0
svg.selectAll("mycircle")
  .data(data)
  .enter()
  .append("circle")
    .attr("cx", x(0) )
    .attr("cy", function(d) { return y(d.Occupation); })
    .attr("r", "4")
    .style("fill", "#C0CFD4")
    .attr("stroke", "#06303D")
    


// Change the X coordinates of line and circle
svg.selectAll("circle")
  .transition()
  .duration(2000)
  .attr("cx", function(d) { return x(d.Value); })

svg.selectAll("line")
  .transition()
  .duration(2000)
  .attr("x1", function(d) { return x(d.Value); })
    

})

</script>